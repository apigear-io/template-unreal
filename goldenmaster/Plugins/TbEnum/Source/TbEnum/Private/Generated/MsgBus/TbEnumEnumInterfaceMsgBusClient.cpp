/**
Copyright 2021 ApiGear UG
Copyright 2021 Epic Games, Inc.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
*/

////////////////////////////////
// WARNING AUTOGENERATED
// DO NOT MODIFY
///////////////////////////////

#include "Generated/MsgBus/TbEnumEnumInterfaceMsgBusClient.h"
#include "Generated/MsgBus/TbEnumEnumInterfaceMsgBusMessages.h"
#include "Async/Async.h"
#include "Engine/Engine.h"
#include "Misc/DateTime.h"
#include "MessageEndpointBuilder.h"
#include "MessageEndpoint.h"
#include <atomic>

/**
   \brief data structure to hold the last sent property values
*/
struct TbEnumEnumInterfacePropertiesMsgBusData
{
	std::atomic<ETbEnumEnum0> Prop0{ETbEnumEnum0::TEE0_VALUE0};
	std::atomic<ETbEnumEnum1> Prop1{ETbEnumEnum1::TEE1_VALUE1};
	std::atomic<ETbEnumEnum2> Prop2{ETbEnumEnum2::TEE2_VALUE2};
	std::atomic<ETbEnumEnum3> Prop3{ETbEnumEnum3::TEE3_VALUE3};
};
DEFINE_LOG_CATEGORY(LogTbEnumEnumInterfaceMsgBusClient);

UTbEnumEnumInterfaceMsgBusClient::UTbEnumEnumInterfaceMsgBusClient()
	: UAbstractTbEnumEnumInterface()
	, _SentData(MakePimpl<TbEnumEnumInterfacePropertiesMsgBusData>())
{
	/* m_sink = std::make_shared<FOLinkSink>("tb.enum.EnumInterface"); */
}

UTbEnumEnumInterfaceMsgBusClient::~UTbEnumEnumInterfaceMsgBusClient() = default;

void UTbEnumEnumInterfaceMsgBusClient::Initialize(FSubsystemCollectionBase& Collection)
{
	Super::Initialize(Collection);

	Connect();
}

void UTbEnumEnumInterfaceMsgBusClient::Deinitialize()
{
	Disconnect();

	Super::Deinitialize();
}

void UTbEnumEnumInterfaceMsgBusClient::Connect()
{
	if (IsConnected())
	{
		return;
	}

	if (TbEnumEnumInterfaceMsgBusEndpoint.IsValid() && !ServiceAddress.IsValid())
	{
		DiscoverService();
		return;
	}

	// clang-format off
	TbEnumEnumInterfaceMsgBusEndpoint = FMessageEndpoint::Builder("ApiGear/TbEnum/EnumInterface/Client")
		.Handling<FTbEnumEnumInterfaceInitMessage>(this, &UTbEnumEnumInterfaceMsgBusClient::OnConnectionInit)
		.Handling<FTbEnumEnumInterfaceServiceDisconnectMessage>(this, &UTbEnumEnumInterfaceMsgBusClient::OnServiceClosedConnection)
		.Handling<FTbEnumEnumInterfaceSig0SignalMessage>(this, &UTbEnumEnumInterfaceMsgBusClient::OnSig0)

		.Handling<FTbEnumEnumInterfaceSig1SignalMessage>(this, &UTbEnumEnumInterfaceMsgBusClient::OnSig1)

		.Handling<FTbEnumEnumInterfaceSig2SignalMessage>(this, &UTbEnumEnumInterfaceMsgBusClient::OnSig2)

		.Handling<FTbEnumEnumInterfaceSig3SignalMessage>(this, &UTbEnumEnumInterfaceMsgBusClient::OnSig3)
		.Handling<FTbEnumEnumInterfaceProp0ChangedMessage>(this, &UTbEnumEnumInterfaceMsgBusClient::OnProp0Changed)

		.Handling<FTbEnumEnumInterfaceProp1ChangedMessage>(this, &UTbEnumEnumInterfaceMsgBusClient::OnProp1Changed)

		.Handling<FTbEnumEnumInterfaceProp2ChangedMessage>(this, &UTbEnumEnumInterfaceMsgBusClient::OnProp2Changed)

		.Handling<FTbEnumEnumInterfaceProp3ChangedMessage>(this, &UTbEnumEnumInterfaceMsgBusClient::OnProp3Changed)
		.Handling<FTbEnumEnumInterfaceFunc0ReplyMessage>(this, &UTbEnumEnumInterfaceMsgBusClient::OnFunc0Reply)
		.Handling<FTbEnumEnumInterfaceFunc1ReplyMessage>(this, &UTbEnumEnumInterfaceMsgBusClient::OnFunc1Reply)
		.Handling<FTbEnumEnumInterfaceFunc2ReplyMessage>(this, &UTbEnumEnumInterfaceMsgBusClient::OnFunc2Reply)
		.Handling<FTbEnumEnumInterfaceFunc3ReplyMessage>(this, &UTbEnumEnumInterfaceMsgBusClient::OnFunc3Reply)
		.Build();
	// clang-format on

	DiscoverService();
}

void UTbEnumEnumInterfaceMsgBusClient::Disconnect()
{
	if (!IsConnected())
	{
		return;
	}

	auto msg = new FTbEnumEnumInterfaceClientDisconnectMessage();

	if (TbEnumEnumInterfaceMsgBusEndpoint.IsValid())
	{
		TbEnumEnumInterfaceMsgBusEndpoint->Send<FTbEnumEnumInterfaceClientDisconnectMessage>(msg, EMessageFlags::Reliable,
			nullptr,
			TArrayBuilder<FMessageAddress>().Add(ServiceAddress),
			FTimespan::Zero(),
			FDateTime::MaxValue());
	}

	TbEnumEnumInterfaceMsgBusEndpoint.Reset();
	ServiceAddress.Invalidate();
	_ConnectionStatusChanged.Broadcast(false);
}

void UTbEnumEnumInterfaceMsgBusClient::DiscoverService()
{
	if (TbEnumEnumInterfaceMsgBusEndpoint.IsValid())
	{
		TbEnumEnumInterfaceMsgBusEndpoint->Publish<FTbEnumEnumInterfaceDiscoveryMessage>(new FTbEnumEnumInterfaceDiscoveryMessage());
	}
}

bool UTbEnumEnumInterfaceMsgBusClient::IsConnected() const
{
	return TbEnumEnumInterfaceMsgBusEndpoint.IsValid() && ServiceAddress.IsValid();
}

void UTbEnumEnumInterfaceMsgBusClient::OnConnectionInit(const FTbEnumEnumInterfaceInitMessage& InInitMessage, const TSharedRef<IMessageContext, ESPMode::ThreadSafe>& Context)
{
	if (!ServiceAddress.IsValid())
	{
		ServiceAddress = Context->GetSender();
		const bool bProp0Changed = InInitMessage.Prop0 != Prop0;
		if (bProp0Changed)
		{
			Prop0 = InInitMessage.Prop0;
			Execute__GetSignals(this)->OnProp0Changed.Broadcast(Prop0);
		}

		const bool bProp1Changed = InInitMessage.Prop1 != Prop1;
		if (bProp1Changed)
		{
			Prop1 = InInitMessage.Prop1;
			Execute__GetSignals(this)->OnProp1Changed.Broadcast(Prop1);
		}

		const bool bProp2Changed = InInitMessage.Prop2 != Prop2;
		if (bProp2Changed)
		{
			Prop2 = InInitMessage.Prop2;
			Execute__GetSignals(this)->OnProp2Changed.Broadcast(Prop2);
		}

		const bool bProp3Changed = InInitMessage.Prop3 != Prop3;
		if (bProp3Changed)
		{
			Prop3 = InInitMessage.Prop3;
			Execute__GetSignals(this)->OnProp3Changed.Broadcast(Prop3);
		}

		_ConnectionStatusChanged.Broadcast(true);
	}
	else
	{
		UE_LOG(LogTbEnumEnumInterfaceMsgBusClient, Error, TEXT("Got a second init message - should not happen"));
	}
}

void UTbEnumEnumInterfaceMsgBusClient::OnServiceClosedConnection(const FTbEnumEnumInterfaceServiceDisconnectMessage& /*InMessage*/, const TSharedRef<IMessageContext, ESPMode::ThreadSafe>& Context)
{
	if (ServiceAddress != Context->GetSender())
	{
		return;
	}

	ServiceAddress.Invalidate();
	_ConnectionStatusChanged.Broadcast(false);
}

ETbEnumEnum0 UTbEnumEnumInterfaceMsgBusClient::GetProp0_Implementation() const
{
	return Prop0;
}

void UTbEnumEnumInterfaceMsgBusClient::SetProp0_Implementation(ETbEnumEnum0 InProp0)
{
	if (!IsConnected())
	{
		UE_LOG(LogTbEnumEnumInterfaceMsgBusClient, Error, TEXT("Client has no connection to service."));
		return;
	}

	// only send change requests if the value changed -> reduce network load
	if (GetProp0_Implementation() == InProp0)
	{
		return;
	}

	// only send change requests if the value wasn't already sent -> reduce network load
	if (_SentData->Prop0 == InProp0)
	{
		return;
	}

	auto msg = new FTbEnumEnumInterfaceSetProp0RequestMessage();
	msg->Prop0 = InProp0;

	if (TbEnumEnumInterfaceMsgBusEndpoint.IsValid())
	{
		TbEnumEnumInterfaceMsgBusEndpoint->Send<FTbEnumEnumInterfaceSetProp0RequestMessage>(msg, EMessageFlags::Reliable,
			nullptr,
			TArrayBuilder<FMessageAddress>().Add(ServiceAddress),
			FTimespan::Zero(),
			FDateTime::MaxValue());
		_SentData->Prop0 = InProp0;
	}
}

ETbEnumEnum1 UTbEnumEnumInterfaceMsgBusClient::GetProp1_Implementation() const
{
	return Prop1;
}

void UTbEnumEnumInterfaceMsgBusClient::SetProp1_Implementation(ETbEnumEnum1 InProp1)
{
	if (!IsConnected())
	{
		UE_LOG(LogTbEnumEnumInterfaceMsgBusClient, Error, TEXT("Client has no connection to service."));
		return;
	}

	// only send change requests if the value changed -> reduce network load
	if (GetProp1_Implementation() == InProp1)
	{
		return;
	}

	// only send change requests if the value wasn't already sent -> reduce network load
	if (_SentData->Prop1 == InProp1)
	{
		return;
	}

	auto msg = new FTbEnumEnumInterfaceSetProp1RequestMessage();
	msg->Prop1 = InProp1;

	if (TbEnumEnumInterfaceMsgBusEndpoint.IsValid())
	{
		TbEnumEnumInterfaceMsgBusEndpoint->Send<FTbEnumEnumInterfaceSetProp1RequestMessage>(msg, EMessageFlags::Reliable,
			nullptr,
			TArrayBuilder<FMessageAddress>().Add(ServiceAddress),
			FTimespan::Zero(),
			FDateTime::MaxValue());
		_SentData->Prop1 = InProp1;
	}
}

ETbEnumEnum2 UTbEnumEnumInterfaceMsgBusClient::GetProp2_Implementation() const
{
	return Prop2;
}

void UTbEnumEnumInterfaceMsgBusClient::SetProp2_Implementation(ETbEnumEnum2 InProp2)
{
	if (!IsConnected())
	{
		UE_LOG(LogTbEnumEnumInterfaceMsgBusClient, Error, TEXT("Client has no connection to service."));
		return;
	}

	// only send change requests if the value changed -> reduce network load
	if (GetProp2_Implementation() == InProp2)
	{
		return;
	}

	// only send change requests if the value wasn't already sent -> reduce network load
	if (_SentData->Prop2 == InProp2)
	{
		return;
	}

	auto msg = new FTbEnumEnumInterfaceSetProp2RequestMessage();
	msg->Prop2 = InProp2;

	if (TbEnumEnumInterfaceMsgBusEndpoint.IsValid())
	{
		TbEnumEnumInterfaceMsgBusEndpoint->Send<FTbEnumEnumInterfaceSetProp2RequestMessage>(msg, EMessageFlags::Reliable,
			nullptr,
			TArrayBuilder<FMessageAddress>().Add(ServiceAddress),
			FTimespan::Zero(),
			FDateTime::MaxValue());
		_SentData->Prop2 = InProp2;
	}
}

ETbEnumEnum3 UTbEnumEnumInterfaceMsgBusClient::GetProp3_Implementation() const
{
	return Prop3;
}

void UTbEnumEnumInterfaceMsgBusClient::SetProp3_Implementation(ETbEnumEnum3 InProp3)
{
	if (!IsConnected())
	{
		UE_LOG(LogTbEnumEnumInterfaceMsgBusClient, Error, TEXT("Client has no connection to service."));
		return;
	}

	// only send change requests if the value changed -> reduce network load
	if (GetProp3_Implementation() == InProp3)
	{
		return;
	}

	// only send change requests if the value wasn't already sent -> reduce network load
	if (_SentData->Prop3 == InProp3)
	{
		return;
	}

	auto msg = new FTbEnumEnumInterfaceSetProp3RequestMessage();
	msg->Prop3 = InProp3;

	if (TbEnumEnumInterfaceMsgBusEndpoint.IsValid())
	{
		TbEnumEnumInterfaceMsgBusEndpoint->Send<FTbEnumEnumInterfaceSetProp3RequestMessage>(msg, EMessageFlags::Reliable,
			nullptr,
			TArrayBuilder<FMessageAddress>().Add(ServiceAddress),
			FTimespan::Zero(),
			FDateTime::MaxValue());
		_SentData->Prop3 = InProp3;
	}
}

ETbEnumEnum0 UTbEnumEnumInterfaceMsgBusClient::Func0_Implementation(ETbEnumEnum0 InParam0)
{
	if (!IsConnected())
	{
		UE_LOG(LogTbEnumEnumInterfaceMsgBusClient, Error, TEXT("Client has no connection to service."));

		return ETbEnumEnum0::TEE0_VALUE0;
	}

	auto msg = new FTbEnumEnumInterfaceFunc0RequestMessage();
	msg->RepsonseId = FGuid::NewGuid();
	msg->Param0 = InParam0;

	if (TbEnumEnumInterfaceMsgBusEndpoint.IsValid())
	{
		TPromise<ETbEnumEnum0> Promise;
		StorePromise(msg->RepsonseId, Promise);

		TbEnumEnumInterfaceMsgBusEndpoint->Send<FTbEnumEnumInterfaceFunc0RequestMessage>(msg, EMessageFlags::Reliable,
			nullptr,
			TArrayBuilder<FMessageAddress>().Add(ServiceAddress),
			FTimespan::Zero(),
			FDateTime::MaxValue());

		return Promise.GetFuture().Get();
	}

	return ETbEnumEnum0::TEE0_VALUE0;
}

void UTbEnumEnumInterfaceMsgBusClient::OnFunc0Reply(const FTbEnumEnumInterfaceFunc0ReplyMessage& InFunc0ReplyMessage, const TSharedRef<IMessageContext, ESPMode::ThreadSafe>& Context)
{
	FulfillPromise(InFunc0ReplyMessage.RepsonseId, InFunc0ReplyMessage.Result);
}

ETbEnumEnum1 UTbEnumEnumInterfaceMsgBusClient::Func1_Implementation(ETbEnumEnum1 InParam1)
{
	if (!IsConnected())
	{
		UE_LOG(LogTbEnumEnumInterfaceMsgBusClient, Error, TEXT("Client has no connection to service."));

		return ETbEnumEnum1::TEE1_VALUE1;
	}

	auto msg = new FTbEnumEnumInterfaceFunc1RequestMessage();
	msg->RepsonseId = FGuid::NewGuid();
	msg->Param1 = InParam1;

	if (TbEnumEnumInterfaceMsgBusEndpoint.IsValid())
	{
		TPromise<ETbEnumEnum1> Promise;
		StorePromise(msg->RepsonseId, Promise);

		TbEnumEnumInterfaceMsgBusEndpoint->Send<FTbEnumEnumInterfaceFunc1RequestMessage>(msg, EMessageFlags::Reliable,
			nullptr,
			TArrayBuilder<FMessageAddress>().Add(ServiceAddress),
			FTimespan::Zero(),
			FDateTime::MaxValue());

		return Promise.GetFuture().Get();
	}

	return ETbEnumEnum1::TEE1_VALUE1;
}

void UTbEnumEnumInterfaceMsgBusClient::OnFunc1Reply(const FTbEnumEnumInterfaceFunc1ReplyMessage& InFunc1ReplyMessage, const TSharedRef<IMessageContext, ESPMode::ThreadSafe>& Context)
{
	FulfillPromise(InFunc1ReplyMessage.RepsonseId, InFunc1ReplyMessage.Result);
}

ETbEnumEnum2 UTbEnumEnumInterfaceMsgBusClient::Func2_Implementation(ETbEnumEnum2 InParam2)
{
	if (!IsConnected())
	{
		UE_LOG(LogTbEnumEnumInterfaceMsgBusClient, Error, TEXT("Client has no connection to service."));

		return ETbEnumEnum2::TEE2_VALUE2;
	}

	auto msg = new FTbEnumEnumInterfaceFunc2RequestMessage();
	msg->RepsonseId = FGuid::NewGuid();
	msg->Param2 = InParam2;

	if (TbEnumEnumInterfaceMsgBusEndpoint.IsValid())
	{
		TPromise<ETbEnumEnum2> Promise;
		StorePromise(msg->RepsonseId, Promise);

		TbEnumEnumInterfaceMsgBusEndpoint->Send<FTbEnumEnumInterfaceFunc2RequestMessage>(msg, EMessageFlags::Reliable,
			nullptr,
			TArrayBuilder<FMessageAddress>().Add(ServiceAddress),
			FTimespan::Zero(),
			FDateTime::MaxValue());

		return Promise.GetFuture().Get();
	}

	return ETbEnumEnum2::TEE2_VALUE2;
}

void UTbEnumEnumInterfaceMsgBusClient::OnFunc2Reply(const FTbEnumEnumInterfaceFunc2ReplyMessage& InFunc2ReplyMessage, const TSharedRef<IMessageContext, ESPMode::ThreadSafe>& Context)
{
	FulfillPromise(InFunc2ReplyMessage.RepsonseId, InFunc2ReplyMessage.Result);
}

ETbEnumEnum3 UTbEnumEnumInterfaceMsgBusClient::Func3_Implementation(ETbEnumEnum3 InParam3)
{
	if (!IsConnected())
	{
		UE_LOG(LogTbEnumEnumInterfaceMsgBusClient, Error, TEXT("Client has no connection to service."));

		return ETbEnumEnum3::TEE3_VALUE3;
	}

	auto msg = new FTbEnumEnumInterfaceFunc3RequestMessage();
	msg->RepsonseId = FGuid::NewGuid();
	msg->Param3 = InParam3;

	if (TbEnumEnumInterfaceMsgBusEndpoint.IsValid())
	{
		TPromise<ETbEnumEnum3> Promise;
		StorePromise(msg->RepsonseId, Promise);

		TbEnumEnumInterfaceMsgBusEndpoint->Send<FTbEnumEnumInterfaceFunc3RequestMessage>(msg, EMessageFlags::Reliable,
			nullptr,
			TArrayBuilder<FMessageAddress>().Add(ServiceAddress),
			FTimespan::Zero(),
			FDateTime::MaxValue());

		return Promise.GetFuture().Get();
	}

	return ETbEnumEnum3::TEE3_VALUE3;
}

void UTbEnumEnumInterfaceMsgBusClient::OnFunc3Reply(const FTbEnumEnumInterfaceFunc3ReplyMessage& InFunc3ReplyMessage, const TSharedRef<IMessageContext, ESPMode::ThreadSafe>& Context)
{
	FulfillPromise(InFunc3ReplyMessage.RepsonseId, InFunc3ReplyMessage.Result);
}

void UTbEnumEnumInterfaceMsgBusClient::OnSig0(const FTbEnumEnumInterfaceSig0SignalMessage& InSig0Message, const TSharedRef<IMessageContext, ESPMode::ThreadSafe>& Context)
{
	if (ServiceAddress != Context->GetSender())
	{
		UE_LOG(LogTbEnumEnumInterfaceMsgBusClient, Error, TEXT("Got a message from wrong service(%s) instead of %s"), *Context->GetSender().ToString(), *ServiceAddress.ToString());
		return;
	}

	Execute__GetSignals(this)->OnSig0Signal.Broadcast(InSig0Message.Param0);
	return;
}

void UTbEnumEnumInterfaceMsgBusClient::OnSig1(const FTbEnumEnumInterfaceSig1SignalMessage& InSig1Message, const TSharedRef<IMessageContext, ESPMode::ThreadSafe>& Context)
{
	if (ServiceAddress != Context->GetSender())
	{
		UE_LOG(LogTbEnumEnumInterfaceMsgBusClient, Error, TEXT("Got a message from wrong service(%s) instead of %s"), *Context->GetSender().ToString(), *ServiceAddress.ToString());
		return;
	}

	Execute__GetSignals(this)->OnSig1Signal.Broadcast(InSig1Message.Param1);
	return;
}

void UTbEnumEnumInterfaceMsgBusClient::OnSig2(const FTbEnumEnumInterfaceSig2SignalMessage& InSig2Message, const TSharedRef<IMessageContext, ESPMode::ThreadSafe>& Context)
{
	if (ServiceAddress != Context->GetSender())
	{
		UE_LOG(LogTbEnumEnumInterfaceMsgBusClient, Error, TEXT("Got a message from wrong service(%s) instead of %s"), *Context->GetSender().ToString(), *ServiceAddress.ToString());
		return;
	}

	Execute__GetSignals(this)->OnSig2Signal.Broadcast(InSig2Message.Param2);
	return;
}

void UTbEnumEnumInterfaceMsgBusClient::OnSig3(const FTbEnumEnumInterfaceSig3SignalMessage& InSig3Message, const TSharedRef<IMessageContext, ESPMode::ThreadSafe>& Context)
{
	if (ServiceAddress != Context->GetSender())
	{
		UE_LOG(LogTbEnumEnumInterfaceMsgBusClient, Error, TEXT("Got a message from wrong service(%s) instead of %s"), *Context->GetSender().ToString(), *ServiceAddress.ToString());
		return;
	}

	Execute__GetSignals(this)->OnSig3Signal.Broadcast(InSig3Message.Param3);
	return;
}

void UTbEnumEnumInterfaceMsgBusClient::OnProp0Changed(const FTbEnumEnumInterfaceProp0ChangedMessage& InProp0Message, const TSharedRef<IMessageContext, ESPMode::ThreadSafe>& Context)
{
	if (ServiceAddress != Context->GetSender())
	{
		UE_LOG(LogTbEnumEnumInterfaceMsgBusClient, Error, TEXT("Got a message from wrong service(%s) instead of %s"), *Context->GetSender().ToString(), *ServiceAddress.ToString());
		return;
	}

	const bool bProp0Changed = InProp0Message.Prop0 != Prop0;
	if (bProp0Changed)
	{
		Prop0 = InProp0Message.Prop0;
		Execute__GetSignals(this)->OnProp0Changed.Broadcast(Prop0);
	}
}

void UTbEnumEnumInterfaceMsgBusClient::OnProp1Changed(const FTbEnumEnumInterfaceProp1ChangedMessage& InProp1Message, const TSharedRef<IMessageContext, ESPMode::ThreadSafe>& Context)
{
	if (ServiceAddress != Context->GetSender())
	{
		UE_LOG(LogTbEnumEnumInterfaceMsgBusClient, Error, TEXT("Got a message from wrong service(%s) instead of %s"), *Context->GetSender().ToString(), *ServiceAddress.ToString());
		return;
	}

	const bool bProp1Changed = InProp1Message.Prop1 != Prop1;
	if (bProp1Changed)
	{
		Prop1 = InProp1Message.Prop1;
		Execute__GetSignals(this)->OnProp1Changed.Broadcast(Prop1);
	}
}

void UTbEnumEnumInterfaceMsgBusClient::OnProp2Changed(const FTbEnumEnumInterfaceProp2ChangedMessage& InProp2Message, const TSharedRef<IMessageContext, ESPMode::ThreadSafe>& Context)
{
	if (ServiceAddress != Context->GetSender())
	{
		UE_LOG(LogTbEnumEnumInterfaceMsgBusClient, Error, TEXT("Got a message from wrong service(%s) instead of %s"), *Context->GetSender().ToString(), *ServiceAddress.ToString());
		return;
	}

	const bool bProp2Changed = InProp2Message.Prop2 != Prop2;
	if (bProp2Changed)
	{
		Prop2 = InProp2Message.Prop2;
		Execute__GetSignals(this)->OnProp2Changed.Broadcast(Prop2);
	}
}

void UTbEnumEnumInterfaceMsgBusClient::OnProp3Changed(const FTbEnumEnumInterfaceProp3ChangedMessage& InProp3Message, const TSharedRef<IMessageContext, ESPMode::ThreadSafe>& Context)
{
	if (ServiceAddress != Context->GetSender())
	{
		UE_LOG(LogTbEnumEnumInterfaceMsgBusClient, Error, TEXT("Got a message from wrong service(%s) instead of %s"), *Context->GetSender().ToString(), *ServiceAddress.ToString());
		return;
	}

	const bool bProp3Changed = InProp3Message.Prop3 != Prop3;
	if (bProp3Changed)
	{
		Prop3 = InProp3Message.Prop3;
		Execute__GetSignals(this)->OnProp3Changed.Broadcast(Prop3);
	}
}

template <typename ResultType>
bool UTbEnumEnumInterfaceMsgBusClient::StorePromise(const FGuid& Id, TPromise<ResultType>& Promise)
{
	FScopeLock Lock(&ReplyPromisesMapCS);
	return ReplyPromisesMap.Add(Id, &Promise) != nullptr;
}

template <typename ResultType>
bool UTbEnumEnumInterfaceMsgBusClient::FulfillPromise(const FGuid& Id, const ResultType& Value)
{
	TPromise<ResultType>* PromisePtr = nullptr;

	{
		FScopeLock Lock(&ReplyPromisesMapCS);
		if (auto** Found = ReplyPromisesMap.Find(Id))
		{
			PromisePtr = static_cast<TPromise<ResultType>*>(*Found);
			ReplyPromisesMap.Remove(Id);
		}
	}

	if (PromisePtr)
	{
		PromisePtr->SetValue(Value);
		return true;
	}
	return false;
}

template bool UTbEnumEnumInterfaceMsgBusClient::StorePromise<ETbEnumEnum0>(const FGuid& Id, TPromise<ETbEnumEnum0>& Promise);
template bool UTbEnumEnumInterfaceMsgBusClient::FulfillPromise<ETbEnumEnum0>(const FGuid& Id, const ETbEnumEnum0& Value);
template bool UTbEnumEnumInterfaceMsgBusClient::StorePromise<ETbEnumEnum1>(const FGuid& Id, TPromise<ETbEnumEnum1>& Promise);
template bool UTbEnumEnumInterfaceMsgBusClient::FulfillPromise<ETbEnumEnum1>(const FGuid& Id, const ETbEnumEnum1& Value);
template bool UTbEnumEnumInterfaceMsgBusClient::StorePromise<ETbEnumEnum2>(const FGuid& Id, TPromise<ETbEnumEnum2>& Promise);
template bool UTbEnumEnumInterfaceMsgBusClient::FulfillPromise<ETbEnumEnum2>(const FGuid& Id, const ETbEnumEnum2& Value);
template bool UTbEnumEnumInterfaceMsgBusClient::StorePromise<ETbEnumEnum3>(const FGuid& Id, TPromise<ETbEnumEnum3>& Promise);
template bool UTbEnumEnumInterfaceMsgBusClient::FulfillPromise<ETbEnumEnum3>(const FGuid& Id, const ETbEnumEnum3& Value);
